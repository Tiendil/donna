
* TODO freeze pydantic models which are possible
* TODO codex should explain what it is doing, while executing requests from donna
* TODO complex story workflow
** TODO list based artifacts
*** TODO LIST artifacts with operations add, remove, replace
*** TODO iterate and groom over goals & objectives
*** TODO iterate over risks
*** TODO build plan from objectives and risks
*** TODO execute the plan by taking actions from the plan
** TODO graph-bases execution of the plan:
*** TODO buiild things-to-do by iterating over it in the contexts of objectives and risjs
*** TODO GRAPH(-LIST) artifacts with additiona operations to describe dependencies between list items
*** TODO build plan on top of things-to-do list
** TODO verify all risks are closed and rollback to planing if not
** TODO verify all objectives are met and rollback to planing if not
** TODO Split the whole worfklow into smaller scenarios/tasks?
** TODO prepare a report after the story is finished
** TODO custom command to run a specific subflow? Or whould we rest it to the agent? It look like agent can deside better, because otherwise we'll introduce a hard coupling between different flows.
** TODO replace "here is the beginning of the story specification" with an introspection of the records?
** TODO refactor records/kinds/items names, place them in order
* TODO tests
** TODO basic / lowest unit tests for primitive operations
** TODO domain-level unit tests
** TODO intergration tests for workflows/stories/scenarios
* TODO optimize imports by moving most used ones to \__init__.py files
* TODO `behavior` can be something on top of workflows. Maybe it be a constructor of workflows. I.e. user define own workflow by parametrizing them via `behavior`.
* TODO Objectives loop
** TODO Full spec on planing activities
** TODO Objectives grooming loop
*** choose unprocessed objective
*** groom objective
*** maybe via a single action request operation? With customized code for searching next objective to process
** TODO Goal-objective relations
** TODO Iterate goals into objectives
** TODO Full objective set grooming (may be moved into separate TODO list, since it may require planing)
** TODO Goals grooming (may be moved into separate TODO list, since it may require planing)
* TODO Do we need counters as a separate entity/config?
* TODO Records navigation + introspection
** TODO donna records ?extract? <kind*> <--property=>*
*** add <display/renderer> as the global object that defines how to render the output
*** maybe display may be just jinja template?
*** dow we really need display? Maybe cells will be ok for technical output?
*** What we need:
**** select by kinds (and display kinds in order?)
**** filter by properties (better to have reach filtering syntax?)
**** run graph opertions on top of the result set? Or maybe just different <sort> operations?
** TODO replace partial description with new ?extract? command
** TODO Maybe we do not need kinds separate from records?
* TODO Consider using https://github.com/toon-format/toon for json formatting in cells
* TODO WE CAN ASK DONNA TO MAKE A FSM FOR DONNA!!! WHICH WILL BE OUR PLAN OF WORK!!!
* TODO virtual persona/roles as spects, so action request can tell whos role should be used to answer or agent could decide by itself
* TODO refactor workflows + operations into configs
** refactor end_to_end_story_cycle into generating artifacts
*** rewrite donna.specifications.planning
*** rewrute meta_work_loop
*** remove `partial_description` renderer
*** remove records functionality
** remove layout.py? It's functionality should be moved to worlds
** global ids vs local ids (for operations)
** remove primitives_registry.py? Since there only artifacts will left
** remove introspections functionality? because it is fully covered by artifacts?
** move all ids from types.py into ids.py
** cleanum ids.py
** search for all left str ids and replace them with proper id types
** merged section configs MUST be parsed directly by pydantic models, no magic
** remove `primitives` submodule?
** do we need WorkflowKind that allow specify different workflow behaviors?
** action request also could be an artifact?
** improve markdown parsing & rendering
*** donna -> donna config  (however, now we have jinja comments {# ... #}
*** donna comment
** Can we finish action request without next operation?
*** Probably not, because the last operation is always `finish`
*** However, now we have Operation.mode = final.
** `donna artifacts` — make namespace argument optional or remove it from validate-all?
** move code.operations into submodules
** should we call validation on every artifact load?
** Render scheme of workflow somewhere?
** break story_loop into multiple workflows?
** tune wording of workflows (what to write before goto)
** move workflow start into session command?
** unify code of different renderers? It is very similar
*** add validation for specificaiton existence in renderers
*** Spec rendere can be unified, since its cli command
** When we start the workflow, should we output the head cells before the first operation?
** We may want, by default load/upload artifacts in a custom donna-managed directory, so, no filenames are needed for agents. This also will help to add right extensions automatically => help agents to anderstand internal formats.
** meta_work_loop.md contains a lot of repetitive commands to read specifications. We should optimize them somehow.
*** Approach 1: move them to the head section text
*** Approach 2: move them to the head section config
*** Approach 3: keep them, but add some meta info on analysis phase that donna can use.
** Run CLI operation
*** new operation type to run cli
*** specify next operations depending on the cli result code
*** update artifacts specification with new code block info
** Improve work with artifact specifications
*** Introspection of renderers
*** Introspection of artifact kinds
*** Introspection of code block formats
**** supported primary formats
**** supported properties
*** update default_text_artifacts_behavior.md to reference introspection instead of harding info.
*** add info about merging configs into default_text_artifacts_behavior.md
*** resolve duplication of config.description and markdown description in the head section of the artifact
*** we can reference artifact_id:operation_id, should we make id required for each section (or, at least, optional) to be able to reference each section?
*** We have duplicated logic: Final operation (that finishes the workflow) and mode = final for operation node (that does not guarantee finishing the workflow).
*** Optionaly (true by default) validate artifact contents before update.
** Planning improvements:
*** align naming of session-level specifications
*** do we need to explicitly reference `session.specification.work_scope.md` if its name has already specified in donna.specifications.planning?
*** {{ edit(specification) }} renderer?
*** {{ run(workflow) }} renderer?
*** Improve planing instuction to explictitly polish list of items (goals, etc.) base on other items forward and backward.
*** Declare explicit refining loop
*** Add mini workflows to polish each kind of records?
*** add tmp directory for intermediate artifacts? mayby in .donna/session/tmp/
* TODO Worlds improvements
** We may want to list worlds via donna cli (introspection?)
** We may want to register world kinds automatically.
* TODO error messages should provide helpful hints for agents
* TODO "Story" term still in some specs for convienience, we should think of a better naming
* TODO artifacts descripion vs intro — they replicate each other, maybe we could keep only one of them? Intro whould work better.
* TODO artifacts improvements
** mark specification sections with tags to allow flexible information extraction
** currently we do not output the whole workflow body on the request of the artifact, only description. Maybe we should output the whole body?
** currently we have different approaches to read/write artifacts: we read them via donna, but write via direct file operations. Maybe we should unify it?
** scripts as artefacts
* TODO Jinja2 improvements
** sandbox mode — do we need it?
** register jinja2 filters?
* TODO Organize standard cell kinds into enum (but allow custom kinds as well). Or just provide custom constructors for each use-case.
* TODO ask codex to straighten the naming/dictionary/terms in the donna project
** review the dictionary of primary terms
* TODO remove mention of <DONNA_CMD> from specs
* TODO errors processing improvements
** Vebose jinja2 render errors to help agents and developers
** replace all NotImplementedError exceptions with custom exceptions and smart error handling
** exceptions must output cells?
