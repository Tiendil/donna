
* TODO freeze pydantic models which are possible
* TODO codex should explain what it is doing, while executing requests from donna
* TODO tests
** basic / lowest unit tests for primitive operations
** domain-level unit tests
** intergration tests for workflows/stories/scenarios
** header of the module must contain the instruction on how to write tests for it?
*** maybe just with links to the spec
* TODO optimize imports by moving most used ones to \__init__.py files
* TODO virtual persona/roles as spects, so action request can tell whos role should be used to answer or agent could decide by itself
* TODO unify code of different directives? It is very similar
** add validation for specificaiton existence in directives
** Spec rendere can be unified, since its cli command
* TODO Specification improvements:
** do we need to explicitly reference `session.specification.work_scope.md` if its name has already specified in donna.specifications.planning?
** {{ edit(specification) }} directive?
** {{ run(workflow) }} directive?
** remove mention of <DONNA_CMD> from specs
** "Story" term still in some specs for convienience, we should think of a better naming
** currently we do not output the whole workflow body on the request of the artifact, only description. Maybe we should output the whole body?
** When we start the workflow, should we output the head cells before the first operation?
** mention jinja comments {# ... #} in artifact specification
** CLI: allow references to sections by full id -> display one specific section of artifact
* TODO Jinja2 improvements
** sandbox mode — do we need it?
** register jinja2 filters?
* TODO Possible workflows
** bootstrap.bootstrap_all.
** bootstrap.donna.create_project
** bootstrap.donna.craete_specifications
** bootstrap.python.create_grooming_workflow
** bootstrap.python.create_project
** morphologica_analysis — workflow for explicit morphological analysis
** simple_task — workflow for simple tasks to not bother with complex story workflows
** Spec-based workflow (like in OpenSpec?)
** Example worflow with iterative factorial calculation
** Example workflow with recursive factorial calculation
* TODO possible specifications
** how to prepare python package with artifacts for donna
** `donna:usage:dictionary` — standard terms and their definitions
* TODO Grooming improvements
** Add spelling validation
** Add import/dependency flow restrictions (there were a specialized package for that)
** Pyright or BasedPyright
*** control that returned values are used
* TODO CLI operation
** Add a new operation kind, that runs cli commands as part of the workflow.
** The operation should not requre interaction with the agent or the user.
** Cli command
*** should start in the same environment as the donna runs
*** should be specified as a string and interpreted as a shell command, pipes are allowed
*** should be specified in a specialized code block
** We consider those commands save enough, because they will be defined in the workflows (i.e. reviewed by humans and agents).
** For this operation, specify next operations depending on the cli result code (as a map in the config block)
*** on success (zero code?)
*** on failure (none zero code?)
*** on specific code
** The next commands should be able to access the cli output (stdout and stderr) via variables.
*** Use WorkUnit context for this
** Update artifacts format specification with new operation info
* TODO We can track causality between artifact sections (what depends on what) as universal functionality of the artifact system. I.e. no need to introduce specialized relations for specialized artifacts.
* TODO interesting software to integrate with
** https://github.com/m0n0x41d/quint-code
** https://github.com/Fission-AI/OpenSpec
** https://www.reddit.com/r/PKMS/comments/1qdgr5a/would_a_simple_pkm_programming_language_make_sense/
** https://github.com/d12frosted/vui.el/
* TODO README.md notes
** `No API keys required.` as a feature
** `save tokens by taking work from your agent to your code`
** compare to https://github.com/Fission-AI/OpenSpec
*** fsms instead of plain texts
*** "better" Markdown
** you can deliver instructions and operations for your package with your package
** goals:
*** maximum determinism
*** maximum introspection
*** LLMs must do only the work they can do better than code
* TODO Request Action: agent has not always use the correctly specified branch, may be we should separate operation with next operation selection?
* TODO Workflows polishing
** Improve planing instuction to explictitly polish list of items (goals, etc.) base on other items forward and backward.
** Declare explicit refining loop
** Add mini workflows to polish each kind of records?
** meta_work_loop.md contains a lot of repetitive commands to read specifications. We should optimize them somehow.
*** Approach 1: move them to the head section text
*** Approach 2: move them to the head section config
*** Approach 3: keep them, but add some meta info on analysis phase that donna can use.
** tune wording of workflows (what to write before goto)
** Planing loop improvement: before initial planing and on each loop try to found uncertain parts of tasks and ask developer to clarify them. Like in deep research.
* TODO Cells & Errors
** !Worflow section validation must validate only chain of sections from the start_operation
*** shouldn't validate the whole artifact
*** remove transitions collection
*** remove find_not_reachable_operations? or rewrite to iterate over reachable sections
** !Uploading artifact does not return errors
*** maybe we should introduce a general errors instead of validation errors, since a lot of code could return reasonable list of errors
** Imprpove cells construction
*** remove cell_donna_message
*** artifact_validation_error_id (for tests?)
*** workflow verification should process all sections
*** for each validation error specify ways to fix it
*** do we need to return success cells from artifact validation?
*** We generate different kinds of cells for different use-cases. That is not reflected in the code well enough.
*** Organize standard cell kinds into enum (but allow custom kinds as well). Or just provide custom constructors for each use-case.
*** ArtifactLocalId -> ArtifactSectionId
*** FullArtifactLocalId -> FullArtifactSectionId
*** remove cell_shortcuts module?
*** implement ErrorCodeId like FullArtifactId or PythonImportPath.
**** maybe we should refactor ids hierarchy in general?
** Errors processing improvements
*** specification on how we process errors
*** Vebose jinja2 render errors to help agents and developers
*** replace all NotImplementedError exceptions with custom exceptions and smart error handling
*** exceptions must output cells?
*** cleanup asserts — replace with real checks and exceptions
*** rust-style errors?
** Cli should always return Cells
** Logs (do we need them now?)
*** stderr
*** turned off by default
** Each primitive must has reference to specification section that explains it
*** cli command to list primitives?
*** cli command to show primitive specification?
*** in case of errors primitives should return cell with reference to their specification section
*** cli command to validate that every specification exists for each primitive
* TODO Donna flow improvements
** lack of donna project directory should not lead to exceptions or errors. Donna should try to locate the project directory with workflow from std world and if it is not initialized, it should offer to initialize it.
** on initialization donna should create some default workflows based on the project configs (grooming, for example)
** create a copy of the default config for the new project
** lock for donna operations on the project
** donna should be able to continue finished session (somewhow). I.e. when the developer ads new details to it.
** Agent can not continue work in finished session => remove all artifacts that may be required.
* Changy for changelog
